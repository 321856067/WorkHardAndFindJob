# redis 内容记录

## 一、redis 入门

### 1. redis 下载

常用环境有两种：windows 和 linux。

windows 下载地址为：https://github.com/MSOpenTech/redis
linux 下载地址为：http://redis.io..download

### 2. redis 配置

redis 的配置有两种方式，分为**配置文件配置**和**配置命令配置**。

第一种方式需要找到 redis 目录下的 redis.config 文件，打开后进行修改并保存。

第二种方式则在启动 redis 的命令客户端工具后输入命令进行修改，如:
```
CONFIG GET CONFIG_SETTING_NAME
CONFIG SET CONFIG_SETTING NEW_CONFIG_VALUE
```
在上面列举的两个命令中，`GET`用于查看，后面加配置项的名称；`SET`用修改，后面加配置项的名称和要设置的新值。（注意：redis 的客户端命令是不区分字母大小写的，另外 `CONFIG GET`查看命令可以使用通配符）

redis 的配置项比较多，大概清单如下：
* (1) **port**：端口配置项，查看和设置 redis 监听端口，默认端口为 6379；
* (2) **bind**：主机地址配置项，查看和绑定的主机地址，默认地址的值为 127.0.0.1。这个选项，在单网卡的机器上，一般不需要修改；
* (3) **timeout**：连接空闲多长要关闭连接，表示客户端限制一段时间后，要关闭连接。如果指定为 0，表示时长不限制。这个选项的默认值为 0，表示默认不限制连接的空闲时长；
* (4) **dbfilename**：制定保存缓存数据库的本地文件名，默认值为 dump.rdb；
* (5) **dir**：指定保存缓存数据的本地文件所存放的目录，默认为安装目录；
* (6) **rdbcompression**：指定存储至本地数据库时是否压缩数据，默认为 yes，redis 采用 LZF 压缩，如果为了节省 CPU 时间，可以关闭该选项，但会导致数据库文件变得巨大；
* (7) **save**：指定在多长时间内，有多少次 key-value 更新操作，就将数据同步到本地数据库文件，save 配置项的格式为`save<seconds><changes>`：`second`表示时间段的长度，`changes`表示变化的次数。如果在`seconds`时间段内，变化了`changes`，则将 redis 缓存数据同步到文件
* (8) **requirepass**：设置 redis 连接密码，如果配置了连接密码，客户端在连接 redis 时需要通过`AUTH<password>`命令提供密码，默认这个选项是关闭的；
* (9) **slaveof**：在主从复制的模式下，设置当前节点为 slave(从)节点时，设置 master(主)节点的 IP 地址和端口，在 redis 启动时，他会主动从 master(主)节点进行数据同步。如果已经是 slave(从)服务器，则会丢掉旧数据集，从新的 master 主服务器同步缓存数据，`设置 slave 节点命令的格式为： slaveof<masterip><masterport>`；
* (10) **masterauth**：在主从复制的模式下，当 master(主)服务器节点设置了密码保护时， slave(从)服务器连接 master(主)服务器的密码，`master 服务器节点设置密码的格式为：masterauth<master-password>`
* (11) **databases**：设置缓存数据库的数量，默认数据库数量为 16 个。这 16 个数据库的 id 为 0-15，默认使用的数据库是第 0 个。可以使用`SELECT <dbid>`命令在连接时通过数据库 id 来指定要使用的数据库。
	databases 配置选项，可以设置多个缓存数据库，不同的数据库存放不同应用的缓存数据。类似于 mysql 数据库中，不同的应用程序数据存储在不同的数据库下，在 redis 中，数据库的名称有一个整数索引标识，而不是由一个字符串名称来表示。在默认情况下，一个客户端连接到数据库 0。可以通过`SELECT <dbid>`命令来切换到不同的数据库。例如，命令`select 2`，将 redis 操作库切换到第 3 个数据库，随后所有的 redis 客户端命令都将使用数据库 3。
	redis 存储的形式是 Key-Value（键-值对），其中 Key（键）不能发生冲突。每个数据库都有属于自己的空间，不必担心之间的 Key 相冲突。在不同的数据库中，相同的 Key 可以分别取到各自的值。
	当清楚缓存数据时，使用`flushdb`命令，只会清楚当前数据库中的数据，而不会影响到其他数据库；而`flushall`命令，则会清楚这个 redis 实例所有数据库（从 0-15）的数据，因此在执行这个命令前要格外小心。
	在 Java 变成中，配置连接 redis 的 uri 连接字符串时，可以指定到具体的数据库，格式为:`redis://用户名：密码@host:port/redis 库名`

### 3. redis 客户端命令

首先通过 redis-cli 命令客户端连接到 redis 本地服务，然后就可以使用命令了。连接的命令为
```
redis-cli -h host（服务器 IP） -p port（端口号，一般默认为 6379） -a password
```
接下来是命令：
* (1) **set**：根据 Key 设置 Value 值
* (2) **get**：根据 Key 获取 Value，当 Key 不存在是，会返回空结果
* (3) **keys**：查找所有符合给定模式（Pattern）的 Key，模式支持多种通配符，大致的规则如下表：
	符号|含义
	---|---
	`?`|匹配一个字符
	`*`|匹配任意个（包括 0 个）字符
	`[-]`|匹配区间内的任意字符，如`a[b-d]`可以匹配"ab","ac","ad"
	`\`|转义符。使用`\?`，可以匹配"?"字符
* (4) **exists**：判断一个 Key 是否存在，如果 Key 存在，则返回整数类型 1，否则返回 0
* (5) **expire**：为指定的 Key 设置过期时间，以秒为单位
* (6) **ttl**：返回指定 Key 的剩余生存时间（ttl，time to live），以秒为单位。如果没有指定剩余时间，默认的剩余生存时间为 -1，表示永久存在
* (7) **type**：返回 Key 所存储的 Value 值的类型。最简单的类型为 String 类型。redis 中有五种数据类型：String（字符串类型）、Hash（哈希类型）、List（列表类型）、Set（集合类型）、Zset（有序集合类型）
* (8) **del**：删除 Key，可以删除一个或多个 Key。返回值是删除的 Key 的个数
* (9) **ping**：检查客户端是否连接成功，如果连接成功，则返回 pong

### 4. key 的命名规范

不是强制规定，单纯是建议。建议使用冒汗作为 superkey 和 subkey 直接的分隔符，如：
```
suoerkey:subkey:subsubkey:subsubsubkey:...
```



## 二、redis 数据类型

redis 中有五种数据类型：String（字符串类型）、Hash（哈希类型）、List（列表类型）、Set（集合类型）、Zset（有序集合类型）

### 1. String 字符串

String 类型是 redis 中最简单的数据结构。它既可以存储文字（例如"hello world"），又可以存储数字（例如整数 10086 和浮点数 3.14），还可以存储二进制数据（例如10010100）。

### 2. List 列表

redis 的 List 类型是基于**双向链表**实现的，可以支持正向、反向查找和遍历。从用户角度来说，List 列表是简单地字符串列表，字符串按照添加的顺序排序。可以添加一个元素到 List 列表的头部（左边）或者尾部（右边）。一个 List 列表最多可以包含 2^32 -1 个元素。

List 列表的典型应用场景：网络社区中最新的发帖列表、简单的消息队列、最新新闻的分页列表、博客的评论列表、排队系统等等。举个例子，在“618”秒杀、抢购这样的大型活动中，短时间有大量的用户请求发现服务器，而后台的程序不可能立刻相应每一个用户的请求，有什么好的办法来解决这个问题呢？我们需要一个排队系统。根据用户的请求时间，将用户的请求放入 List 列表中，后台程序依次从队列中获取任务，处理并将结果返回到结果列表。换句话说，通过 List 列表，可以将并行的请求转换成串行的任务队列。

### 3. Hash 哈希表

redis 中的 Hash 哈希表是一个 **String 类型的 Field 字段和 Value 值之间的映射表**，类似于 Java 中的 HashMap。一个哈希表有多个字段-值对（Field-Value Pairs）组成，Value 值可以是文字、整数、浮点数或者二进制数据。在同一个 Hash 哈希表中，每个 Field 字段的名称必须是唯一的。这一点和 Java 中的 HashMap 的 Key 键的规范要求也是相同的。

### 4. Set 集合

Set 集合也是一个列表，不过它的特殊之处在于它是可以自动去掉重复元素的。Set 集合类型的使用场景式：当需要存储一个列表，而又不希望有重复的元素（例如 ID 的集合）时，使用 Set 是一个很好地选择。并且 Set 类型拥有一个命令，它可以用于判断某个元素是否存在，而 List 类型并没有这种功能。

通过 Set 集合类型的命令可以快速地向集合添加元素，或者从集合里面删除元素，也可以对多个 Set 集合进行集合运算，比如并集、交集、差集。

### 5. Zset 有序集合

Zset 有序集合和 Set 集合的使用场景类似，区别是有序集合会根据提供的 score 参数来进行自动排序，底层是用**跳跃表**来实现的。当需要一个不重复的且有序的集合列表，那么就可以选择 Zset 有序集合类型。常用案例：游戏中的排行榜。

Zset 有序集合和 Set 不同的是，有序集合的每个元素，都关联着一个分值（score），这是一个浮点数格式的关联值。Zset 有序集合会按照分值（score），按从小到大的顺序来排列有序集合中的各个元素。
